export default (function (filePath, extMap) {
  if (!filePath) {
    return filePath;
  }

  if (0 !== filePath.indexOf(".") && -1 === filePath.indexOf("!.")) {
    return filePath; // not local import
  }

  var baseName = filePath.split("/").splice(-1)[0];
  var extDotPos = baseName.lastIndexOf(".");
  var extNone = extMap[""];
  delete extMap[""];

  if (-1 === extDotPos) {
    // No extension
    return extNone ? filePath + extNone : filePath;
  }

  var extKeys = Object.keys(extMap);
  var nextPath = filePath;
  var isFind;
  var i = extKeys.length;

  while (i--) {
    var fromExt = extKeys[i];

    if (extDotPos === baseName.lastIndexOf(fromExt)) {
      nextPath = filePath.slice(0, -fromExt.length) + extMap[fromExt];
      isFind = true;
      break;
    }
  }

  if (extNone && nextPath === filePath && isFind) {
    nextPath = filePath + extNone;
  }

  return nextPath;
});